---
title: "Expression array normalization and analysis"
author: "Lindsay A Holden"
date: "June 6, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = 'E:/LINDSAY/expression arrays/all arrays') ## working directory for all R chunks
```

## Outline

Initial normalization based on Mattick Lab protocol, see  
<http://matticklab.com/index.php?title=Single_channel_analysis_of_Agilent_microarray_data_with_Limma>  

1. normalize arrays  

    a) load libraries, target file, annotations, and gene list  
    b) load data into an RGList object  
    c) assign spot types and set the status of each spot on the array  
    d) subract background fluorescence  
    e) normalize between arrays  
    f) average replicate spots  
 \ 
2. applying linear model  

    a) create a design matrix for linear modeling function  
    b) apply intensity values to lmFit (linear model)  
    c) create contrast matrix for your comparison of interest  
    d) apply contrast matrix to modeled data & compute statistics  
    e) output stats  
    f) annotate output  

## Normalize arrays

### Load libraries

Load the libraries you'll be using.

```{r libraries}
library(limma)
```

### Load target file

Load your target file containing SampleNumber, FileName, and Condition data. Make sure to include full filepath. In my target file each row is one sample and each column is one descriptor.

```{r targets}
targets <- readTargets(file = "targets.txt")
names(targets) ## to view the column names
```

### Load annotations

These annotations are what come from Agilent. Currently, they are Zv9 (danRer7) and should be queried against more updated releases of RefGene, ENTREZ, ENSEMBL, etc.

```{r annotations}
annotations <- read.csv("AllAnnotations.csv")
names(annotations) ## to view the column names
```

### Load genelist

The genelist is pretty much the same thing as annotations and also come from Agilent. Currently, they are Zv9 (danRer7) and should be queried against more updated releases of RefGene, ENTREZ, ENSEMBL, etc.

```{r genelist}
genelist <- read.delim2("E:/LINDSAY/expression arrays/all arrays/genelist_withcontrols.txt")
## there is another file named "genelist.txt" that might also be appropriate
names(genelist) ## to view the column names 
```

### Load array files

Using read.maimages, load extracted array files (txt output from Agilent's Feature Extraction Program) as an EListRaw from a set of one-color files.

```{r data, results = "hide"}
a <- read.maimages(targets,
                   source = "agilent", ## same as "agilent.median" other option is "agilent.mean"
                   green.only = TRUE) ## need to identify if I need to do incorporate "Wt.fun" this
```


This takes a minute or two (depending on how many files you have to load). Then check how many arrays loaded.

```{r data}
dim(a)
colnames(a)
```


